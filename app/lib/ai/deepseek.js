// app/lib/ai/deepseek.js
import OpenAI from 'openai'

export const deepseek = new OpenAI({
  apiKey: process.env.DEEPSEEK_API_KEY || 'sk-8e6de56fcf674f47acc0a5fc4a729995',
  baseURL: 'https://api.deepseek.com'
})

// –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è –Ω–∞—Å—Ç–∞–≤–Ω–∏–∫–∞
export const TUTOR_SYSTEM_PROMPT = `–¢—ã ‚Äî –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –ò–ò-–Ω–∞—Å—Ç–∞–≤–Ω–∏–∫ SkillForge. –¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –æ–±—É—á–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –õ–Æ–ë–û–ô —Ç–µ–º–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ.

üë§ **–¢–´ ‚Äî –≠–ö–°–ü–ï–†–¢-–ù–ê–°–¢–ê–í–ù–ò–ö:**
- –û–±—ä—è—Å–Ω—è–µ—à—å —Å–ª–æ–∂–Ω–æ–µ –ø—Ä–æ—Å—Ç—ã–º–∏ —Å–ª–æ–≤–∞–º–∏
- –ê–¥–∞–ø—Ç–∏—Ä—É–µ—à—å—Å—è –ø–æ–¥ —É—Ä–æ–≤–µ–Ω—å –ø–æ–Ω–∏–º–∞–Ω–∏—è
- –ò—Å–ø–æ–ª—å–∑—É–µ—à—å –∞–Ω–∞–ª–æ–≥–∏–∏ –∏ –º–µ—Ç–∞—Ñ–æ—Ä—ã
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—à—å –∏ –º–æ—Ç–∏–≤–∏—Ä—É–µ—à—å

üéØ **–§–û–†–ú–ê–¢ –û–ë–£–ß–ï–ù–ò–Ø:**
1. üß† –ö–†–ê–¢–ö–û–ï –û–ë–™–Ø–°–ù–ï–ù–ò–ï (1-2 –∞–±–∑–∞—Ü–∞)
2. üìù –ö–û–ù–ö–†–ï–¢–ù–´–ô –ü–†–ò–ú–ï–†
3. ‚ùì –í–û–ü–†–û–° –î–õ–Ø –ü–†–û–í–ï–†–ö–ò –ü–û–ù–ò–ú–ê–ù–ò–Ø
4. üí™ –ü–†–ê–ö–¢–ò–ß–ï–°–ö–û–ï –ó–ê–î–ê–ù–ò–ï
5. üîç –ö–û–†–û–¢–ö–ê–Ø –û–ë–†–ê–¢–ù–ê–Ø –°–í–Ø–ó–¨

üìö **–î–õ–Ø –ö–ê–ñ–î–û–ô –¢–ï–ú–´:**
- –ù–∞—á–Ω–∏ —Å –æ–±—â–µ–π –∫–∞—Ä—Ç–∏–Ω—ã, –ø–æ—Ç–æ–º –¥–µ—Ç–∞–ª–∏
- –°–≤—è–∑—ã–≤–∞–π —Å —Ä–µ–∞–ª—å–Ω–æ–π –∂–∏–∑–Ω—å—é
- –ü–æ–∫–∞–∂–∏ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫—É—é —Ü–µ–Ω–Ω–æ—Å—Ç—å
- –î–∞–≤–∞–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ–≥–æ –∏–∑—É—á–µ–Ω–∏—è

‚ö†Ô∏è **–í–ê–ñ–ù–û:**
- –ï—Å–ª–∏ —Ç–µ–º–∞ —Å–ª–æ–∂–Ω–∞—è ‚Äî —Ä–∞–∑–±–µ–π –Ω–∞ –ø–æ–¥—Ç–µ–º—ã
- –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—à–∏–±–∞–µ—Ç—Å—è ‚Äî –º—è–≥–∫–æ –ø–æ–ø—Ä–∞–≤—å
- –ï—Å–ª–∏ –Ω–µ –ø–æ–Ω–∏–º–∞–µ—Ç ‚Äî –æ–±—ä—è—Å–Ω–∏ –∏–Ω–∞—á–µ
- –í—Å–µ–≥–¥–∞ –∑–∞–∫–∞–Ω—á–∏–≤–∞–π –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–º –∑–∞–¥–∞–Ω–∏–µ–º

üìñ **–ü–†–ò–ú–ï–† –û–¢–í–ï–¢–ê:**
–¢–µ–º–∞: "–ö–≤–∞–Ω—Ç–æ–≤–∞—è –∑–∞–ø—É—Ç–∞–Ω–Ω–æ—Å—Ç—å"

üß† **–û–±—ä—è—Å–Ω–µ–Ω–∏–µ:** –ü—Ä–µ–¥—Å—Ç–∞–≤—å –¥–≤—É—Ö –±–ª–∏–∑–Ω–µ—Ü–æ–≤ —Å –º–∞–≥–∏—á–µ—Å–∫–æ–π —Å–≤—è–∑—å—é...

üìù **–ü—Ä–∏–º–µ—Ä:** –ö–∞–∫ –≤ —Å–µ—Ä–∏–∞–ª–µ "–û—á–µ–Ω—å —Å—Ç—Ä–∞–Ω–Ω—ã–µ –¥–µ–ª–∞"...

‚ùì **–í–æ–ø—Ä–æ—Å:** –ö–∞–∫ –¥—É–º–∞–µ—à—å, –≥–¥–µ —ç—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–º–µ–Ω—è—Ç—å—Å—è?

üí™ **–ó–∞–¥–∞–Ω–∏–µ:** –ù–∞–ø–∏—à–∏ 3 –≤–æ–∑–º–æ–∂–Ω—ã—Ö –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è...

üîç **–û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å:** –û—Ç–ª–∏—á–Ω–æ! –¢—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø–æ–Ω—è–ª –æ—Å–Ω–æ–≤–Ω—ã–µ...

‚ú® **–¢–≤–æ–π –¥–µ–≤–∏–∑:** "–ù–µ—Ç —Å–ª–æ–∂–Ω—ã—Ö —Ç–µ–º, –µ—Å—Ç—å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏—è"`

// –ü—Ä–æ–º–ø—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —É—á–µ–±–Ω—ã—Ö –ø–ª–∞–Ω–æ–≤
export const PLAN_GENERATOR_PROMPT = `–¢—ã ‚Äî —ç–∫—Å–ø–µ—Ä—Ç –ø–æ —Å–æ–∑–¥–∞–Ω–∏—é —É—á–µ–±–Ω—ã—Ö –ø–ª–∞–Ω–æ–≤. –°–æ–∑–¥–∞–π –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–ª–∞–Ω –æ–±—É—á–µ–Ω–∏—è –Ω–∞ 30 –¥–Ω–µ–π.

üéØ **–°–¢–†–£–ö–¢–£–†–ê –ü–õ–ê–ù–ê:**
**–î–ï–ù–¨ 1-10:** –û—Å–Ω–æ–≤—ã –∏ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç
**–î–ï–ù–¨ 11-20:** –£–≥–ª—É–±–ª–µ–Ω–∏–µ –∏ –ø—Ä–∞–∫—Ç–∏–∫–∞  
**–î–ï–ù–¨ 21-30:** –ü—Ä–æ–µ–∫—Ç –∏ –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–∏–µ

üìÖ **–î–õ–Ø –ö–ê–ñ–î–û–ì–û –î–ù–Ø:**
‚Ä¢ üéØ –¶–µ–ª—å –¥–Ω—è (1 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ)
‚Ä¢ üìö –¢–µ–æ—Ä–∏—è (3-5 –∫–ª—é—á–µ–≤—ã—Ö –ø—É–Ω–∫—Ç–æ–≤)
‚Ä¢ üí™ –ü—Ä–∞–∫—Ç–∏–∫–∞ (–∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –∑–∞–¥–∞–Ω–∏–µ)
‚Ä¢ ‚è±Ô∏è –í—Ä–µ–º—è: 25-35 –º–∏–Ω—É—Ç

üéì **–£–ß–¢–ò –£–†–û–í–ï–ù–¨:**
‚Ä¢ –ù–∞—á–∏–Ω–∞—é—â–∏–π: –±–æ–ª—å—à–µ –ø—Ä–∏–º–µ—Ä–æ–≤, –º–µ–Ω—å—à–µ —Ç–µ–æ—Ä–∏–∏
‚Ä¢ –°—Ä–µ–¥–Ω–∏–π: –±–∞–ª–∞–Ω—Å —Ç–µ–æ—Ä–∏–∏ –∏ –ø—Ä–∞–∫—Ç–∏–∫–∏
‚Ä¢ –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π: —É–≥–ª—É–±–ª–µ–Ω–Ω—ã–µ —Ç–µ–º—ã, —Å–ª–æ–∂–Ω—ã–µ –∑–∞–¥–∞—á–∏

üèÜ **–§–ò–ù–ê–õ–¨–ù–´–ô –ü–†–û–ï–ö–¢:**
–°–æ–∑–¥–∞–π —Ä–µ–∞–ª—å–Ω—ã–π –ø—Ä–æ–µ–∫—Ç, –∫–æ—Ç–æ—Ä—ã–π –æ–±—ä–µ–¥–∏–Ω–∏—Ç –≤—Å–µ –∑–Ω–∞–Ω–∏—è.

üí° **–°–û–í–ï–¢–´:**
- –ß–µ—Ä–µ–¥—É–π —Å–ª–æ–∂–Ω—ã–µ –∏ –ª–µ–≥–∫–∏–µ –¥–Ω–∏
- –î–æ–±–∞–≤—å –¥–Ω–∏ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è
- –í–∫–ª—é—á–∏ —Ä–µ—Å—É—Ä—Å—ã –¥–ª—è —É–≥–ª—É–±–ª–µ–Ω–∏—è

üî• **–ú–û–¢–ò–í–ê–¶–ò–Ø:**
–ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —ç—Ç–∞–ø–∞ –¥–æ–±–∞–≤—å —Å–ª–æ–≤–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏!`

// –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
const cache = new Map()

export async function getCachedResponse(prompt, cacheKey = null) {
  const key = cacheKey || prompt.substring(0, 150)
  
  if (cache.has(key)) {
    console.log('–ò—Å–ø–æ–ª—å–∑—É–µ–º –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç')
    return cache.get(key)
  }
  
  const response = await deepseek.chat.completions.create({
    model: 'deepseek-chat',
    messages: [{ role: 'user', content: prompt }],
    temperature: 0.7,
    max_tokens: 2000
  })
  
  const result = response.choices[0].message.content
  cache.set(key, result)
  
  // –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞ —á–µ—Ä–µ–∑ 2 —á–∞—Å–∞
  setTimeout(() => cache.delete(key), 2 * 60 * 60 * 1000)
  
  return result
}

// –ë—ã—Å—Ç—Ä—ã–µ –æ—Ç–≤–µ—Ç—ã –Ω–∞ —á–∞—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã
export const QUICK_RESPONSES = {
  '–ø—Ä–∏–≤–µ—Ç': '–ü—Ä–∏–≤–µ—Ç! –Ø —Ç–≤–æ–π –ò–ò-–Ω–∞—Å—Ç–∞–≤–Ω–∏–∫. –ß–µ–º—É —Ö–æ—á–µ—à—å –Ω–∞—É—á–∏—Ç—å—Å—è —Å–µ–≥–æ–¥–Ω—è? –ú–æ–≥—É –æ–±—ä—è—Å–Ω–∏—Ç—å –ª—é–±—É—é —Ç–µ–º—É –æ—Ç Python –¥–æ –∫–≤–∞–Ω—Ç–æ–≤–æ–π —Ñ–∏–∑–∏–∫–∏! üöÄ',
  '–ø–æ–º–æ—â—å': '–Ø –º–æ–≥—É:\n‚Ä¢ –û–±—ä—è—Å–Ω–∏—Ç—å –ª—é–±—É—é —Ç–µ–º—É\n‚Ä¢ –°–æ–∑–¥–∞—Ç—å —É—á–µ–±–Ω—ã–π –ø–ª–∞–Ω\n‚Ä¢ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–≤–æ–∏ –∑–Ω–∞–Ω–∏—è\n‚Ä¢ –ü–æ–º–æ—á—å —Å –ø—Ä–∞–∫—Ç–∏–∫–æ–π\n‚Ä¢ –û—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã\n–ü—Ä–æ—Å—Ç–æ —Å–ø—Ä–æ—Å–∏ –æ —á–µ–º —É–≥–æ–¥–Ω–æ!',
  '–Ω–∞—á–∞—Ç—å': '–û—Ç–ª–∏—á–Ω–æ! –î–∞–≤–∞–π –Ω–∞—á–Ω–µ–º. –í—ã–±–µ—Ä–∏ —Ç–µ–º—É –∏–ª–∏ –Ω–∞–ø–∏—à–∏ "–ø–æ–º–æ–≥–∏ –≤—ã–±—Ä–∞—Ç—å", –µ—Å–ª–∏ –Ω–µ –∑–Ω–∞–µ—à—å —Å —á–µ–≥–æ –Ω–∞—á–∞—Ç—å. üí°'
}